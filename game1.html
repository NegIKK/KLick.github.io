<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>21 ¬∑ Z-–∫–∞–∑–∏–Ω–æ</title>
    <style>
        @font-face {
            font-family: 'Ithaca';
            src: url('res/ofont_Ithaca.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Ithaca', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0f23, #1a1a3e);
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .game-container {
            width: 100%;
            max-width: 1000px;
            background: rgba(25, 25, 45, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            border: 1px solid #00ffff55;
            position: relative;
        }

        h1 {
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff, 0 0 20px #0066ff;
            font-size: 2.8em;
            margin-bottom: 20px;
            text-align: center;
        }

        .balance-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #00b3ff;
            border-radius: 12px;
            padding: 15px 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .balance-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .balance-label {
            color: #88d0ff;
            font-size: 1em;
        }

        .balance-value {
            color: #ffffff;
            font-size: 1.6em;
            font-weight: bold;
        }

        .bet-section {
            background: rgba(0, 180, 255, 0.1);
            border: 1px solid #00b3ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .bet-title {
            color: #aaa;
            font-size: 1.1em;
        }

        .bet-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .bet-input {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00c6ff;
            border-radius: 8px;
            padding: 12px 20px;
            color: white;
            font-size: 1.2em;
            width: 150px;
            text-align: center;
        }

        .bet-input:focus {
            outline: none;
            box-shadow: 0 0 15px #00ffff;
        }

        button {
            background: linear-gradient(45deg, #00b3ff, #0077ff);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 180, 255, 0.3);
        }

        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 180, 255, 0.5);
        }

        button:active:not(:disabled) {
            transform: scale(0.96);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #444;
        }

        .deal-btn {
            background: linear-gradient(45deg, #00ff9d, #00b366);
            min-width: 200px;
            font-size: 1.4em;
            padding: 15px 40px;
        }

        .game-table {
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 1px solid #448aff;
        }

        .player-area, .dealer-area {
            text-align: left;
        }

        .area-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #88d0ff;
            font-size: 1.3em;
        }

        .cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            min-height: 120px;
        }

        .card {
            background: linear-gradient(145deg, #ffffff, #e6e9f0);
            border-radius: 12px;
            padding: 15px 20px;
            box-shadow: 0 8px 0 #0a0a1a, 0 10px 20px black;
            color: #0a0a1a;
            font-size: 2.2em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 110px;
            border: 2px solid #00ffff;
            animation: slideIn 0.3s ease-out;
        }

        .card-red {
            color: #e63946;
        }

        .card-black {
            color: #1e1e2f;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-area {
            text-align: center;
            font-size: 1.8em;
            margin: 20px 0;
            padding: 20px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.5);
            border-left: 8px solid #00ffff;
            color: #ffffff;
            text-shadow: 0 0 5px #00ffff;
        }

        .win {
            color: #b0ff8c;
            border-left-color: #00ff88;
        }

        .lose {
            color: #ff8c8c;
            border-left-color: #ff4444;
        }

        .draw {
            color: #ffd700;
            border-left-color: #ffaa00;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .hit-btn {
            background: linear-gradient(45deg, #ff9900, #ff6600);
        }

        .stand-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff3b3b);
        }

        .return-btn {
            background: linear-gradient(45deg, #4caf50, #2e7d32);
            margin-top: 20px;
        }

        .footer {
            margin-top: 30px;
            color: #aaa;
            font-size: 0.9em;
            text-align: center;
        }

        /* —ç—Ñ—Ñ–µ–∫—Ç –º–æ–Ω–µ—Ç–æ–∫ */
        .effect-coin {
            position: fixed;
            color: #ffd700;
            font-size: 26px;
            font-weight: bold;
            pointer-events: none;
            z-index: 9999;
            animation: coinFly 1s forwards;
            text-shadow: 0 0 5px #ffaa00;
        }

        @keyframes coinFly {
            0% { opacity: 1; transform: scale(1) translateY(0); }
            100% { opacity: 0; transform: scale(1.8) translateY(-60px); }
        }

        .changelog-btn {
            position: fixed;
            bottom: 15px;
            right: 15px;
            background: #007bff;
            padding: 10px 18px;
            border-radius: 30px;
            font-size: 0.9em;
            opacity: 0.7;
            transition: 0.3s;
        }

        .changelog-btn:hover {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .game-container { padding: 20px; }
            h1 { font-size: 2.2em; }
            .card { font-size: 1.8em; min-width: 65px; height: 95px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>‚ô†Ô∏è 21 ‚ô•Ô∏è</h1>
        
        <!-- –ë–∞–ª–∞–Ω—Å USD –∏–∑ –±–∏—Ä–∂–∏ -->
        <div class="balance-panel">
            <div class="balance-item">
                <span class="balance-label">–í–∞—à –±–∞–ª–∞–Ω—Å USD</span>
                <span id="usdBalance" class="balance-value">0.00</span>
            </div>
            <div class="balance-item">
                <span class="balance-label">–¢–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞</span>
                <span id="currentBetDisplay" class="balance-value" style="color: #ffd700;">0.00 $</span>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è —Å—Ç–∞–≤–∫–∏ -->
        <div class="bet-section">
            <span class="bet-title">üí∞ –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É (–º–∏–Ω–∏–º—É–º 1 USD)</span>
            <div class="bet-controls">
                <input type="number" id="betAmount" class="bet-input" value="10" min="1" step="1" placeholder="–°—É–º–º–∞">
                <button id="dealBtn" class="deal-btn">üé≤ –°–¥–∞—Ç—å –∫–∞—Ä—Ç—ã</button>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–æ–π —Å—Ç–æ–ª -->
        <div class="game-table">
            <!-- –î–∏–ª–µ—Ä -->
            <div class="dealer-area">
                <div class="area-header">
                    <span>üñ•Ô∏è –î–∏–ª–µ—Ä</span>
                    <span id="dealerScore">–û—á–∫–∏: 0</span>
                </div>
                <div id="dealerCards" class="cards"></div>
            </div>
            
            <!-- –ò–≥—Ä–æ–∫ -->
            <div class="player-area">
                <div class="area-header">
                    <span>üë§ –ò–≥—Ä–æ–∫</span>
                    <span id="playerScore">–û—á–∫–∏: 0</span>
                </div>
                <div id="playerCards" class="cards"></div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞—É–Ω–¥–∞ -->
        <div id="resultMessage" class="result-area">üÉè –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É –∏ –Ω–∞—á–Ω–∏—Ç–µ –∏–≥—Ä—É</div>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (Hit / Stand) -->
        <div class="action-buttons">
            <button id="hitBtn" class="hit-btn" disabled>‚ûï –í–∑—è—Ç—å –∫–∞—Ä—Ç—É</button>
            <button id="standBtn" class="stand-btn" disabled>‚èπÔ∏è –•–≤–∞—Ç–∏—Ç</button>
        </div>

        <!-- –í–æ–∑–≤—Ä–∞—Ç –≤ Z-–º–∞–π–Ω–∏–Ω–≥ -->
        <div style="display: flex; justify-content: center;">
            <button id="returnBtn" class="return-btn">‚¨Ö –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ Z‚Äë–º–∞–π–Ω–∏–Ω–≥</button>
        </div>
        
        <div class="footer">
            <p>21 ‚Äî —Ü–µ–ª—å –Ω–∞–±—Ä–∞—Ç—å 21 –∏–ª–∏ –±—ã—Ç—å –±–ª–∏–∂–µ –∫ 21, —á–µ–º –¥–∏–ª–µ—Ä. –¢—É–∑ = 1 –∏–ª–∏ 11.</p>
            <p>–í—ã–∏–≥—Ä—ã—à: x2 –æ—Ç —Å—Ç–∞–≤–∫–∏. –ù–∏—á—å—è ‚Äî –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏.</p>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ Changelog (–∫–∞–∫ –≤ index) -->
    <button class="changelog-btn" onclick="openChangelog21()">üìú Changelog</button>

    <script>
        // -----------------------------
        // –ó–í–£–ö–ò (–∏–∑ –ø–∞–ø–∫–∏ res, –∫–∞–∫ –≤ —Å–ª–æ—Ç–∞—Ö)
        // -----------------------------
        const cardSound = new Audio('res/click.wav');      // –∑–≤—É–∫ –∫–∞—Ä—Ç—ã (–∏—Å–ø–æ–ª—å–∑—É–µ–º click.wav)
        const winSound = new Audio('res/win.mp3');
        const loseSound = new Audio('res/lose.mp3');       // –µ—Å–ª–∏ –Ω–µ—Ç ‚Äî –∑–∞–≥–ª—É—à–∫–∞
        const chipSound = new Audio('res/coin_buy.mp3');   // —Å—Ç–∞–≤–∫–∞

        cardSound.volume = 0.5;
        winSound.volume = 0.8;
        chipSound.volume = 0.6;
        if (loseSound) loseSound.volume = 0.7;

        // –µ—Å–ª–∏ lose.mp3 –Ω–µ—Ç ‚Äî —Å–æ–∑–¥–∞—ë–º –∑–∞–≥–ª—É—à–∫—É (–Ω–µ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∏)
        loseSound.onerror = () => { console.log('lose.mp3 –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∞'); };

        // -----------------------------
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // -----------------------------
        let gameData = {
            usdBalance: 10.00      // USD –±–∞–ª–∞–Ω—Å ‚Äî –±–µ—Ä—ë–º –∏–∑ localStorage
        };

        let currentBet = 10;        // —Ç–µ–∫—É—â–∞—è —Å—Ç–∞–≤–∫–∞
        let playerHand = [];
        let dealerHand = [];
        let gameActive = false;    // –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ä–∞—É–Ω–¥
        let gameResult = null;     // 'win', 'lose', 'draw'

        // -----------------------------
        // –ó–ê–ì–†–£–ó–ö–ê USD –ò–ó localStorage (Z-–ë–∏—Ä–∂–∞ / Z-–º–∞–π–Ω–∏–Ω–≥)
        // -----------------------------
        function loadBalance() {
            try {
                const saved = localStorage.getItem('zMining');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    // –ë–µ—Ä—ë–º usdBalance, –µ—Å–ª–∏ –µ—Å—Ç—å, –∏–Ω–∞—á–µ –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â–∏–π
                    if (typeof parsed.usdBalance === 'number') {
                        gameData.usdBalance = parsed.usdBalance;
                    }
                }
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–∞–ª–∞–Ω—Å–∞:', e);
            }
            // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 2 –∑–Ω–∞–∫–æ–≤
            gameData.usdBalance = Math.round(gameData.usdBalance * 100) / 100;
            updateBalanceUI();
        }

        // -----------------------------
        // –°–û–•–†–ê–ù–ï–ù–ò–ï USD –í localStorage
        // -----------------------------
        function saveBalance() {
            try {
                const saved = localStorage.getItem('zMining');
                let gameState = saved ? JSON.parse(saved) : {};
                gameState.usdBalance = gameData.usdBalance;
                localStorage.setItem('zMining', JSON.stringify(gameState));
                console.log('–ë–∞–ª–∞–Ω—Å USD —Å–æ—Ö—Ä–∞–Ω—ë–Ω:', gameData.usdBalance);
            } catch (e) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞:', e);
            }
        }

        // -----------------------------
        // –û–ë–ù–û–í–õ–ï–ù–ò–ï –ò–ù–¢–ï–†–§–ï–ô–°–ê –ë–ê–õ–ê–ù–°–ê
        // -----------------------------
        function updateBalanceUI() {
            document.getElementById('usdBalance').textContent = gameData.usdBalance.toFixed(2);
            document.getElementById('currentBetDisplay').textContent = currentBet.toFixed(2) + ' $';
        }

        // -----------------------------
        // –ü–û–õ–£–ß–ï–ù–ò–ï –°–õ–£–ß–ê–ô–ù–û–ô –ö–ê–†–¢–´
        // -----------------------------
        function getRandomCard() {
            const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const rank = ranks[Math.floor(Math.random() * ranks.length)];
            const suit = suits[Math.floor(Math.random() * suits.length)];
            
            let value = 0;
            if (rank === 'A') value = 11; // —Ç—É–∑ ‚Äî 11 (–ø–æ–∑–∂–µ –∞–¥–∞–ø—Ç–∏—Ä—É–µ–º)
            else if (['J', 'Q', 'K'].includes(rank)) value = 10;
            else value = parseInt(rank);
            
            return { rank, suit, value };
        }

        // -----------------------------
        // –ü–û–î–°–ß–Å–¢ –û–ß–ö–û–í (—Å –∞–¥–∞–ø—Ç–∞—Ü–∏–µ–π —Ç—É–∑–∞)
        // -----------------------------
        function calculateScore(hand) {
            let score = 0;
            let aces = 0;
            
            hand.forEach(card => {
                score += card.value;
                if (card.rank === 'A') aces++;
            });
            
            // –µ—Å–ª–∏ –ø–µ—Ä–µ–±–æ—Ä –∏ –µ—Å—Ç—å —Ç—É–∑—ã ‚Äî —É–º–µ–Ω—å—à–∞–µ–º —Å 11 –¥–æ 1
            while (score > 21 && aces > 0) {
                score -= 10;
                aces--;
            }
            return score;
        }

        // -----------------------------
        // –û–¢–†–ò–°–û–í–ö–ê –ö–ê–†–¢
        // -----------------------------
        function renderCards() {
            const playerContainer = document.getElementById('playerCards');
            const dealerContainer = document.getElementById('dealerCards');
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç –∏–≥—Ä–æ–∫–∞
            playerContainer.innerHTML = '';
            playerHand.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                // –∫—Ä–∞—Å–Ω—ã–µ –º–∞—Å—Ç–∏
                if (card.suit === '‚ô•' || card.suit === '‚ô¶') {
                    cardEl.classList.add('card-red');
                } else {
                    cardEl.classList.add('card-black');
                }
                cardEl.textContent = `${card.rank}${card.suit}`;
                playerContainer.appendChild(cardEl);
            });
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–∞—Ä—Ç –¥–∏–ª–µ—Ä–∞
            dealerContainer.innerHTML = '';
            dealerHand.forEach((card, index) => {
                const cardEl = document.createElement('div');
                cardEl.className = 'card';
                if (card.suit === '‚ô•' || card.suit === '‚ô¶') {
                    cardEl.classList.add('card-red');
                } else {
                    cardEl.classList.add('card-black');
                }
                cardEl.textContent = `${card.rank}${card.suit}`;
                dealerContainer.appendChild(cardEl);
            });

            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—á–∫–∏
            document.getElementById('playerScore').textContent = `–û—á–∫–∏: ${calculateScore(playerHand)}`;
            document.getElementById('dealerScore').textContent = `–û—á–∫–∏: ${calculateScore(dealerHand)}`;
        }

        // -----------------------------
        // –≠–§–§–ï–ö–¢ –ú–û–ù–ï–¢–û–ö (–ø—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ)
        // -----------------------------
        function createCoinEffect(amount) {
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const coin = document.createElement('div');
                    coin.className = 'effect-coin';
                    coin.textContent = `+${amount.toFixed(2)}$`;
                    coin.style.left = Math.random() * window.innerWidth + 'px';
                    coin.style.top = Math.random() * window.innerHeight + 'px';
                    coin.style.color = '#ffd700';
                    document.body.appendChild(coin);
                    setTimeout(() => coin.remove(), 1000);
                }, i * 50);
            }
        }

        // -----------------------------
        // –ù–ê–ß–ê–õ–û –ù–û–í–û–ì–û –†–ê–£–ù–î–ê
        // -----------------------------
        function startRound() {
            // –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞–≤–∫—É
            const betInput = document.getElementById('betAmount');
            let bet = parseFloat(betInput.value);
            if (isNaN(bet) || bet < 1) bet = 1;
            // –û–≥—Ä–∞–Ω–∏—á–∏–º —Å—Ç–∞–≤–∫—É –±–∞–ª–∞–Ω—Å–æ–º
            if (bet > gameData.usdBalance) {
                alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ USD! –í–∞—à –±–∞–ª–∞–Ω—Å: ${gameData.usdBalance.toFixed(2)}$`);
                return;
            }
            
            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            gameData.usdBalance -= bet;
            gameData.usdBalance = Math.round(gameData.usdBalance * 100) / 100;
            currentBet = bet;
            saveBalance();
            updateBalanceUI();
            
            // –ó–≤—É–∫ —Å—Ç–∞–≤–∫–∏
            chipSound.play().catch(e => {});

            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä—É–∫–∏
            playerHand = [];
            dealerHand = [];
            
            // –†–∞–∑–¥–∞—ë–º –ø–æ 2 –∫–∞—Ä—Ç—ã
            playerHand.push(getRandomCard());
            playerHand.push(getRandomCard());
            dealerHand.push(getRandomCard());
            dealerHand.push(getRandomCard());
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –±–ª—ç–∫–¥–∂–µ–∫ (21 —Å—Ä–∞–∑—É)
            const playerScore = calculateScore(playerHand);
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∏–≥—Ä—É
            gameActive = true;
            document.getElementById('dealBtn').disabled = true;
            document.getElementById('hitBtn').disabled = false;
            document.getElementById('standBtn').disabled = false;
            
            // –ó–≤—É–∫ –∫–∞—Ä—Ç
            cardSound.play().catch(e => {});
            
            renderCards();
            
            // –ï—Å–ª–∏ —É –∏–≥—Ä–æ–∫–∞ —Å—Ä–∞–∑—É 21 ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ stand
            if (playerScore === 21) {
                stand();
            }
        }

        // -----------------------------
        // –í–ó–Ø–¢–¨ –ö–ê–†–¢–£ (HIT)
        // -----------------------------
        function hit() {
            if (!gameActive) return;
            
            playerHand.push(getRandomCard());
            cardSound.play().catch(e => {});
            
            renderCards();
            
            const playerScore = calculateScore(playerHand);
            
            // –ü–µ—Ä–µ–±–æ—Ä ‚Äî –∏–≥—Ä–æ–∫ –ø—Ä–æ–∏–≥—Ä–∞–ª
            if (playerScore > 21) {
                endRound('lose', '–ü–µ—Ä–µ–±–æ—Ä! –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.');
            }
        }

        // -----------------------------
        // –•–í–ê–¢–ò–¢ (STAND)
        // -----------------------------
        function stand() {
            if (!gameActive) return;
            
            gameActive = false;
            document.getElementById('hitBtn').disabled = true;
            document.getElementById('standBtn').disabled = true;
            
            // –î–∏–ª–µ—Ä –¥–æ–±–∏—Ä–∞–µ—Ç –¥–æ 17
            while (calculateScore(dealerHand) < 17) {
                dealerHand.push(getRandomCard());
                cardSound.play().catch(e => {});
            }
            
            renderCards();
            
            const playerScore = calculateScore(playerHand);
            const dealerScore = calculateScore(dealerHand);
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            if (dealerScore > 21) {
                endRound('win', `–î–∏–ª–µ—Ä –ø–µ—Ä–µ–±—Ä–∞–ª! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${(currentBet * 2).toFixed(2)}$`);
            } else if (playerScore > dealerScore) {
                endRound('win', `–í—ã –Ω–∞–±—Ä–∞–ª–∏ ${playerScore}, –¥–∏–ª–µ—Ä ${dealerScore}. –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${(currentBet * 2).toFixed(2)}$`);
            } else if (playerScore < dealerScore) {
                endRound('lose', `–í—ã –Ω–∞–±—Ä–∞–ª–∏ ${playerScore}, –¥–∏–ª–µ—Ä ${dealerScore}. –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.`);
            } else {
                endRound('draw', `–ù–∏—á—å—è! –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞.`);
            }
        }

        // -----------------------------
        // –ó–ê–í–ï–†–®–ï–ù–ò–ï –†–ê–£–ù–î–ê
        // -----------------------------
        function endRound(result, message) {
            gameActive = false;
            document.getElementById('hitBtn').disabled = true;
            document.getElementById('standBtn').disabled = true;
            document.getElementById('dealBtn').disabled = false;
            
            const resultDiv = document.getElementById('resultMessage');
            resultDiv.textContent = message;
            resultDiv.classList.remove('win', 'lose', 'draw');
            
            let winAmount = 0;
            
            if (result === 'win') {
                winAmount = currentBet * 2;
                gameData.usdBalance += winAmount;
                gameData.usdBalance = Math.round(gameData.usdBalance * 100) / 100;
                resultDiv.classList.add('win');
                winSound.play().catch(e => {});
                createCoinEffect(winAmount);
            } else if (result === 'lose') {
                resultDiv.classList.add('lose');
                loseSound.play().catch(e => {});
                winAmount = 0;
            } else if (result === 'draw') {
                gameData.usdBalance += currentBet; // –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏
                gameData.usdBalance = Math.round(gameData.usdBalance * 100) / 100;
                resultDiv.classList.add('draw');
                winAmount = 0;
            }
            
            saveBalance();
            updateBalanceUI();
        }

        // -----------------------------
        // –í–û–ó–í–†–ê–¢ –í –û–°–ù–û–í–ù–£–Æ –ò–ì–†–£
        // -----------------------------
        function returnToMining() {
            saveBalance();
            window.location.href = 'index.html';
        }

        // -----------------------------
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // -----------------------------
        window.addEventListener('load', () => {
            loadBalance();
            updateBalanceUI();
            
            // –ö–Ω–æ–ø–∫–∏
            document.getElementById('dealBtn').addEventListener('click', startRound);
            document.getElementById('hitBtn').addEventListener('click', hit);
            document.getElementById('standBtn').addEventListener('click', stand);
            document.getElementById('returnBtn').addEventListener('click', returnToMining);
            
            // –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å localStorage (–Ω–∞ —Å–ª—É—á–∞–π –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ)
            setInterval(() => {
                loadBalance();
            }, 3000);
        });

        // -----------------------------
        // CHANGELOG
        // -----------------------------
        function openChangelog21() {
            const changelogText = `
Changelog ‚Äî 21 (Z-–∫–∞–∑–∏–Ω–æ) v1.0.0

üÉè –ù–æ–≤–∞—è –∏–≥—Ä–∞ ¬´21¬ª (–æ—á–∫–æ/–±–ª—ç–∫–¥–∂–µ–∫)
‚Äî –ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–ª–∞–Ω—Å–æ–º USD –∏–∑ Z-–±–∏—Ä–∂–∏ / Z-–º–∞–π–Ω–∏–Ω–≥–∞.
‚Äî –°—Ç–∞–≤–∫–∏ –≤ USD, –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞ 1$.
‚Äî –ü—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ ‚Äî x2 –æ—Ç —Å—Ç–∞–≤–∫–∏.
‚Äî –ù–∏—á—å—è ‚Äî –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏.

üé® –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ:
‚Äî –°—Ç–∏–ª—å –∫–∏–±–µ—Ä–ø–∞–Ω–∫, –µ–¥–∏–Ω—ã–π —Å Z-–º–∞–π–Ω–∏–Ω–≥–æ–º.
‚Äî –ê–Ω–∏–º–∞—Ü–∏—è –∫–∞—Ä—Ç, —Ü–≤–µ—Ç–Ω—ã–µ –º–∞—Å—Ç–∏.
‚Äî –≠—Ñ—Ñ–µ–∫—Ç –º–æ–Ω–µ—Ç–æ–∫ –ø—Ä–∏ –≤—ã–∏–≥—Ä—ã—à–µ.

üîä –ó–≤—É–∫–∏:
‚Äî click.wav ‚Äî —Ä–∞–∑–¥–∞—á–∞ –∫–∞—Ä—Ç.
‚Äî win.mp3 ‚Äî –≤—ã–∏–≥—Ä—ã—à.
‚Äî coin_buy.mp3 ‚Äî —Å—Ç–∞–≤–∫–∞.

üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ:
‚Äî –ë–∞–ª–∞–Ω—Å USD —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å localStorage (–∫–ª—é—á zMining).
‚Äî –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ä–∞—É–Ω–¥–∞ –±–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –∏–≥—Ä–µ –∏ –±–∏—Ä–∂–µ.

üîÑ –ü–µ—Ä–µ—Ö–æ–¥:
‚Äî –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ Z-–º–∞–π–Ω–∏–Ω–≥ (index.html).
‚Äî –ê–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è USD –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã.

–í–µ—Ä—Å–∏—è –æ—Ç 12.02.2026
            `;
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                <head><title>Changelog ¬∑ 21</title>
                <style>
                    body { font-family: 'Ithaca', sans-serif; background: #0f0f23; color: #e0e0e0; padding: 30px; }
                    pre { background: #1a1a3e; padding: 20px; border-radius: 12px; border-left: 5px solid #00ffff; }
                    button { background: #00b3ff; color: white; border: none; padding: 10px 25px; border-radius: 8px; cursor: pointer; }
                </style>
                </head>
                <body>
                    <h2>üìú 21 ‚Äî —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π</h2>
                    <pre>${changelogText}</pre>
                    <button onclick="window.close()">–ó–∞–∫—Ä—ã—Ç—å</button>
                </body>
                </html>
            `);
        }

        // –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –≥–ª–æ–±–∞–ª—å–Ω–æ–π
        window.openChangelog21 = openChangelog21;
    </script>
</body>
</html>